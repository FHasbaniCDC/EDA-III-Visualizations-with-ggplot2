---
title: "Data Wrangling and Visualization Basics with ggplot2 "
content: Diamonds and economics
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Free memory Functions

```{r}
# Clear environment
rm(list = ls()) 

# Clear packages
# pacman::p_unload(rgl)

# Clear plots
# dev.off()  # But only if there IS a plot

# Clear console
cat("\014")  # ctrl+L
```

######################################################################################################
# Data exploration
#######################################################################################################

### Basic data exploration

#### Reading in and basic formatting of data

Start by reading in and formatting the data.

## Reading in diamond dataset from ggplot2

```{r}
require(ggplot2)
data(diamonds)
head(diamonds)
```


#######################################################################################################
## Graphical Methods
#######################################################################################################

# Now that we’ve checked for missing values and typos and made corrections, we can graphically examine the sample data distribution of our data. Frequency distributions are useful because they can help us visualize the center (e.g., RV) and spread or dispersion (e.g., low and high) of our data. Typically in introductory statistics the normal (i.e., Gaussian) distribution is emphasized.

Short Description of Graphical Methods
Plot Types	       Description
Bar:	             a plot where each bar represents the frequency of observations for a ‘group’
Histogram:         a plot where each bar represents the frequency of observations for a ‘given range of values’
Density:	         an estimation of the frequency distribution based on the sample data
Box-Whisker:	     a visual representation of median, quartiles, symmetry, skewness, and outliers
Scatter & Line:    a graphical display of one variable plotted on the x axis and another on the y axis
Quantile-Quantile: a plot of the actual data values against a normal distribution


## ##  Histogram
A histogram is similar to a bar plot, except that instead of summarizing categorical data, it categorizes a continuous variable like clay content into non-overlappying intervals for the sake of display. The number of intervals can be specified by the user, or can be automatically determined using an algorithm, such as nclass.Sturges(). Since histograms are dependent on the number of bins, for small datasets they’re not the best method of determining the shape of a distribution.

# Histogram - base graphics

```{r}
hist(diamonds$carat, main="Carat Histogram", xlab="Carat")
```

# Histogram - ggplot

```{r}
ggplot(data = diamonds) + geom_histogram(aes(x=carat), bins = 100) 
```


# Density Curve

A density estimation, also known as a Kernel density plot, generally provides a better visualization of the shape of the distribution in comparison to the histogram. Compared to the histogram where the y-axis represents the number or percent (i.e., frequency) of observations, the y-axis for the density plot represents the probability of observing any given value, such that the area under the curve equals one. One curious feature of the density curve is the hint of a two peaks (i.e. bimodal distribution?). Given that our sample includes a mixture of surface and subsurface horizons, we may have two different populations. However considering how much the two distributions overlap, it seems impractical to separate them in this instance.

## Density plot using ggplot2

```{r}
ggplot(data=diamonds) + geom_density(aes(x=carat) , fill = "grey50")
```

##  Box plots
Box plots are a graphical representation of the five number summary, depicting quartiles (i.e. the 25%, 50%, and 75% quantiles), minimum, maximum and outliers (if present). Boxplots convey the shape of the data distribution, the presence of extreme values, and the ability to compare with other variables using the same scale, providing an excellent tool for screening data, determining thresholds for variables and developing working hypotheses.

The parts of the boxplot are shown in the figure below. The “box” of the boxplot is defined as the 1st quartile, (Q1 in the figure) and the 3rd quartile, (Q3 in the figure). The median, or 2nd quartile, is the dark line in the box. The whiskers (typically) show data that is 1.5 * IQR above and below the 3rd and 1st quartile. Any data point that is beyond a whisker is considered an outlier.

That is not to say the outlier points are in error, just that they are extreme compared to the rest of the dataset. However, you may want to evaluate these points to ensure that they are correct.

## Boxplots with base graphics

```{r}
boxplot(diamonds$carat)
```

## Boxplot using ggplot2

```{r}
ggplot(diamonds,aes(y=carat,x=1)) + geom_boxplot()
```

```{r}
ggplot(diamonds,aes(y=carat,x=cut)) + geom_boxplot()
```

## Violin Plots using ggplot2

```{r}
require(gridExtra)
p1 <- ggplot(diamonds,aes(y=carat,x=cut)) + geom_point() + geom_violin()

p2 <- ggplot(diamonds,aes(y=carat,x=cut)) + geom_violin() + geom_point()

grid.arrange(p1, p2, ncol=2)
```

##  Scatter plot 
Plotting points of one ratio or interval variable against another is a scatter plot. Plots can be produced for a single or multiple pairs of variables. Many independent variables are often under consideration in soil survey work. This is especially common when GIS is used, which offers the potential to correlate soil attributes with a large variety of raster datasets.

The purpose of a scatterplot is to see how one variable relates to another. With modeling in general the goal is parsimony (i.e., simple). The goal is to determine the fewest number of variables required to explain or describe a relationship. If two variables explain the same thing, i.e., they are highly correlated, only one variable is needed. The scatterplot provides a perfect visual reference for this.

Create a basic scatter plot using the loafercreek dataset.

## Scatterplot with base graphics

```{r}
plot(price ~ carat, data = diamonds)
```

## Scatterplot without using formula

```{r}
plot(diamonds$carat, diamonds$price)
```

## Scatterplot using ggplot2

```{r}
g <- ggplot(diamonds, aes(x=carat,y=price))
g + geom_point(aes(color=color))
```

## Facet_wrap and facet_grid in ggplot2

```{r}
g + geom_point(aes(color=color)) + facet_wrap(~color)
```

```{r}
g + geom_point(aes(color=color)) + facet_grid(cut~clarity)
```

## Theme in ggplot2

There are ten themes built in to ggplot2 3.3.5. Here are seven:

theme_bw(): a variation on theme_grey() that uses a white background and thin grey grid lines.

theme_linedraw(): A theme with only black lines of various widths on white backgrounds, reminiscent of a line drawing.

theme_light(): similar to theme_linedraw() but with light grey lines and axes, to direct more attention towards the data.

theme_dark(): the dark cousin of theme_light(), with similar line sizes but a dark background. Useful to make thin coloured lines pop out.

theme_minimal(): A minimalistic theme with no background annotations.

theme_classic(): A classic-looking theme, with x and y axis lines and no gridlines.

theme_void(): A completely empty theme.


```{r}
# Using diamonds
#install.packages('ggthemes')
library(ggthemes)
g2 <- ggplot(diamonds, aes(x=carat,y=price)) + geom_point(aes(color=color))

## Lets apply few themes
p1 <- g2 + theme_economist() + scale_color_economist()
p2 <- g2 + theme_excel() + scale_color_excel()
p3 <- g2 + theme_tufte()
p4 <- g2 + theme_wsj()
grid.arrange(p1, p2, p3, p4, nrow=2, ncol=2)
```


## Line plots using ggplot2

```{r}
data(economics)
head(economics)
```

```{r}
ggplot(economics, aes(x=date,y=pop)) + geom_line()
```

## Preparing data for multiple line charts

```{r}
require(lubridate)
## Create month and year columns
economics$year <- year(economics$date)
economics$month <- month(economics$date)
## Subset the data
econ2000 <- economics[which(economics$year>=2000),]
head(econ2000)
```

```{r}
g <- ggplot(econ2000,aes(x=month,y=pop))
g <- g + geom_line(aes(color=factor(year), group=year))
g <- g + scale_color_discrete(name="Year")
g <- g + labs(title="Population Growth", x="Month",y="Population")
g
```